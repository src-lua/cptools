#!/usr/bin/env python3
# Install: ./install.sh
"""
cptools - Competitive Programming Tools

Usage:
    cptools new [url]                    Create a new contest
    cptools add <name>                   Add a single file with template
    cptools mark <problem> [status]      Mark problem status (default: AC)
    cptools status [directory]           Show contest progress summary
    cptools open <problem>               Open problem URL in browser
    cptools test <problem>               Compile and test a solution
    cptools fetch <problem>              Fetch sample test cases
    cptools stress <sol> <brute> <gen>   Stress test solution vs brute force
    cptools clean [--all | directory]    Remove compiled binaries
    cptools update [--all | directory]   Update info.md
    cptools init [directory]             Initialize a new contest repo
    cptools config                       Edit configuration
    cptools commit [directory]           Commit and push changes
    cptools bundle <problem>             Bundle includes and copy to clipboard
"""
import sys
import os

SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, SCRIPT_DIR)

from commands.common import Colors
BLUE, BOLD, GREEN, FAIL, ENDC = Colors.BLUE, Colors.BOLD, Colors.GREEN, Colors.FAIL, Colors.ENDC

COMMANDS = {
    'new':    'Create a new contest     (e.g. cptools new <url>)',
    'add':    'Add a file or problem    (e.g. cptools add A2 | cptools add <url>)',
    'mark':   'Mark problem status      (e.g. cptools mark A)',
    'status': 'Show contest progress    (e.g. cptools status)',
    'open':   'Open problem in browser  (e.g. cptools open A)',
    'test':   'Compile and test         (e.g. cptools test A)',
    'fetch':  'Fetch sample test cases  (e.g. cptools fetch A~E)',
    'stress': 'Stress test              (e.g. cptools stress A brute gen)',
    'clean':  'Remove compiled binaries (e.g. cptools clean --all)',
    'update': 'Update info.md           (e.g. cptools update --all)',
    'init':   'Initialize contest repo  (e.g. cptools init)',
    'config': 'Edit configuration       (e.g. cptools config)',
    'commit': 'Commit and push          (e.g. cptools commit)',
    'bundle': 'Bundle includes to clip  (e.g. cptools bundle A)',
}

def print_help():
    print(f"{BOLD}cptools{ENDC} - Competitive Programming Tools\n")
    print(f"{BOLD}Usage:{ENDC} cptools <command> [args]\n")
    print(f"{BOLD}Commands:{ENDC}")
    for cmd, desc in COMMANDS.items():
        print(f"  {GREEN}{cmd:<8}{ENDC}  {desc}")
    print(f"\nRun {BLUE}cptools <command> --help{ENDC} for more info on a command.")

def main():
    if len(sys.argv) < 2 or sys.argv[1] in ['-h', '--help']:
        print_help()
        sys.exit(0)

    command = sys.argv[1]

    # Rewrite sys.argv so the sub-script sees its own args
    sys.argv = [command] + sys.argv[2:]

    if command == 'new':
        from commands import new_contest
        new_contest.main()

    elif command == 'add':
        from commands import add_file
        add_file.main()

    elif command == 'mark':
        from commands import mark_status
        mark_status.main()

    elif command == 'status':
        from commands import contest_status
        contest_status.main()

    elif command == 'open':
        from commands import open
        open.main()

    elif command == 'test':
        from commands import test
        test.main()

    elif command == 'fetch':
        from commands import fetch
        fetch.main()

    elif command == 'stress':
        from commands import stress
        stress.main()

    elif command == 'clean':
        from commands import clean
        clean.main()

    elif command == 'update':
        from commands import update_info
        update_info.main()

    elif command == 'init':
        from commands import init
        init.main()

    elif command == 'config':
        from commands import config
        config.main()

    elif command == 'commit':
        from commands import commit
        commit.main()

    elif command == 'bundle':
        from commands import bundle
        bundle.main()

    else:
        print(f"{FAIL}Unknown command: {command}{ENDC}\n")
        print_help()
        sys.exit(1)

if __name__ == "__main__":
    main()
